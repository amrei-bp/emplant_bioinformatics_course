---
title: "Quality Control of Sequencing Data"
format: 
    closeread-html:
        cr-section:
            layout: "overlay-center"
        cr-style:
            section-background-color: "#ffffff"
---
<br>
By the end of this module, you should be able to:

1. Explain why QC of sequencing data is necessary.
2. Interpret FastQC reports and their warnings.
3. Decide what action (if any) to take based on QC results.

## From plant tissue to sequencing reads

Before we talk about quality control, it is important to understand how sequencing data is produced. Many of the problems we detect during QC originate early in the sequencing workflow.

At a high level, the process looks like this:

> Plant tissue → DNA extraction → Library preparation → Sequencing → FASTQ files

Each step can introduce technical effects that later appear in quality control reports. Let's have a closer look:

:::{.cr-section}

::: {#cr-sticky_sampling}
![](figures/qc/sampling.png)
:::

@cr-sticky_sampling We start with **plant tissue** and extract the contained DNA.  

::: {#cr-sticky_prep}
![](figures/qc/library_prep.png)
:::

@cr-sticky_prep Next, sequencing machines do not read whole chromosomes. Instead, DNA is broken into **many small fragments**, the so called **DNA library**.

::: {#cr-sticky_seq}
![](figures/qc/sequencing.png)
:::

@cr-sticky_seq The **DNA library** (with adapters added), is then run on a **sequencing machine**, which calls the bases of each fragment.

The final output are usually **FASTQ files**, which contain raw reads and quality scores.  
:::

## Why do we need quality control?

When we work with sequencing data, we usually want to answer a **biological question**.

In plant breeding, these could for example be:

- Which genetic variants are associated with a certain trait?
- Which alleles are present in a breeding line?
- How similar are two plant populations?
- Which genes are expressed under certain conditions?

All of these questions rely on the assumption that
**the sequencing data reflects the real biology of the plant.**

Quality control (QC) is the step where we check whether this assumption is reasonable.

As such, QC is not about making the data “look nice”. It is about making sure that **technical problems do not lead to wrong biological conclusions**.


## What can go wrong if data quality is poor?

Sequencing errors do not stay “technical”. They can directly affect how we interpret the biology:

| Technical issue                | Biological consequence    |
| --------------------- | ------------------------- |
| Low base quality | Identification of false SNPs                |
| Adapter contamination            | Detection of artificial variants       |
| GC bias                      | Skewed allele frequency estimates |
| High duplication           | Overconfidence in genotypes   |

<br> 
In a breeding context, this can mean that we might **choose the wrong markers**, **miss true marker-trait associations** or **misjudgement or genetiv diversity**.

Quality control helps us detect these problems *before* we trust the results.


## Where do sequencing errors come from?

Sequencing errors can be introduced at several steps, long before we ever see a FASTQ file.

### Step 1: DNA extraction

![](figures/qc/sampling.png){.class width=40%}

Plant material can be challenging to work with. Different issuea can affect the quality of the reads that will be sequenced:

-  Compounds such as polyphenols and polysaccharides can interfere with enzymes or make the DNA sticky.
- DNA quality can vary strongly between samples, depending on the extraction method, tissue and extractor.



### Step 2: Library preparation

![](figures/qc/library_prep.png){.class width=40%}

During library preparation, the DNA is sheared into fragments, adapters are ligated to these DNA fragments and the DNA is often amplified using PCR.

Sometimes, the DNA already degrades before the library preparation. That can lead to **uneven sequencing coverage** in the sequenced reads. The **PCR can introduce a bias**, where some fragments are amplified more than others. 

All these effects are *technical*, but they **shape the data we later analyse**.


### Sequencing

![](figures/qc/sequencing.png){.class width=40%}

Sequencing run itself can introduce errors. Base calling becomes less accurate toward the end of reads and errors accumulate across sequencing cycles. Different lanes or runs can have different overall quality. 



## Why plant genomes are special

Many QC tools are **generic**. They do not “know” that your data comes from plants.

However, plant genomes often have features that affect quality:

- Large genome sizes
- High repeat content
- Polyploidy
- High heterozygosity
- Variable GC content between species

As a result, the GC content plots may look unusual even for good data. High duplication levels are not always a technical problem. So, some warnings are expected and acceptable.

This means that **QC results must always be interpreted in a biological context**.

Quality control tools can show you *what* looks unusual —  you need biological knowledge to decide *why*.


## What is FastQC?

After sequencing, the first files we usually receive are FASTQ files. These files contain millions of short sequencing reads together with a quality score for every base.

**Looking directly at raw FASTQ files is not practical.**  

FastQC is a tool for quality control on raw sequence data coming from high throughput sequencing. It takes your raw data and performs a series of standardized tests, and produces an **easy-to-read overview report** with figures and tables for each sample. 

FastQC provides information about your samples, it does not know what experiment you performed, or what you plan to do with your data afterwards. Thus, the **interpretation and decisions are up to you.** After checking the quality you might want to use other tools to correct errors, remove low-quality data, etc. 

## Interpreting FastQC flags

Each FastQC module ends with a simple label: **pass**, **warning**, or **fail**. These labels are often misunderstood. A fail does not mean the data is unusable. Alternatively, a pass does not mean the data is perfect.

The flags are based on generic thresholds that work reasonably well across many datasets, but they are not tailored to specific organisms or analyses. In plant breeding projects, it is common to see warnings or failures even in perfectly usable datasets.

FastQC flags should therefore be treated as **signals to investigate**, not as automatic decisions.

## A FastQC report

The following is adapted from the excellent [FastQC tutorial at Babraham Bioinformatics](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/Help/3%20Analysis%20Modules/). 

### [Basic statistics](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/Help/3%20Analysis%20Modules/1%20Basic%20Statistics.html)

![](figures/qc/bsic_stats_qc.png){.class width=50%}

Simple summary statistics for the file that was analyzed. Good to check what sample was used, and to get initial stats on the sample. This section will never raise warnings. 

### [Per base sequence quality](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/Help/3%20Analysis%20Modules/2%20Per%20Base%20Sequence%20Quality.html)

![](figures/qc/per_base_qc.png){.class width=50%}

This plot shows the **quality score at each position in the read**. The higher the score, the better the base call. 

This plot answers a simple question: *How confident are we in the base calls along the read?*

In most sequencing datasets, quality is highest at the beginning of the read and decreases toward the end. This pattern is normal and expected, a modest drop in quality at the end of reads is usually not a serious problem.

However, the sample can be problematic when:

- Quality drops very sharply. 
- Large parts of the read have very low scores.
- Quality varies strongly between samples. 


### [Per Sequence Quality Scores](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/Help/3%20Analysis%20Modules/3%20Per%20Sequence%20Quality%20Scores.html)

![](figures/qc/sequence_quality.png){.class width=50%}

While the previous plot looks at quality **per position**, this plot looks at quality **per read**.

It allows you to see if a subset of your sequences have low quality values, or if the quality is homogeneous across the reads of your sample. 

The low quality reads should obviously only represent a small percentage of the total sequences. If a significant proportion of the sequences are of low quality there could be some kind of systematic problem. 

In plant breeding data, poor per-sequence quality can indicate issues such as:

- Problems during library preparation.
- Technical issues during sequencing.
- Low-quality starting material.

### [Per Base Sequence Content]()

![](figures/qc/Base_sequence_content.png){.class width=50%}

This module shows the proportion of the bases - A, C, G, and T - at each position in the read. For random genomic DNA, these proportions should be relatively stable across the read length.

Some types of library will always produce biased sequence composition, normally at the start of the read. Not every deviation from equal base content is a problem. The key question is whether the pattern is expected given the experiment.

In plant genomes, GC content can vary naturally between regions, and this can influence this plot. 

### [Per Sequence GC Content](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/Help/3%20Analysis%20Modules/5%20Per%20Sequence%20GC%20Content.html)

![](figures/qc/gc_content.png){.class width=50%}

The GC content plot shows the overall GC distribution of reads in the sample. FastQC compares the observed distribution to a theoretical expectation, and can help identify contamination.

The **expectation is a roughly normal distribution** of GC content where the peak represents the overall GC content of the underlying genome. However, the acutal shape of the curve depends highly on your sample. 

In plant datasets, unusual GC content does not automatically mean contamination.  

It can reflect:

- Genome composition
- Repetitive regions
- Targeted sequencing approaches

This plot becomes **more informative when comparing samples to each other**, rather than judging a single sample in isolation.


### [Per Base N Content](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/Help/3%20Analysis%20Modules/6%20Per%20Base%20N%20Content.html)

![](figures/qc/n_content.png){.class width=50%}

If a sequencer is unable to make a base call with sufficient confidence it will call an “N” rather than a conventional base. 

It is not unusual to see a very low proportion of Ns appearing in a sequence, especially closer to the end of a sequence. 


### [Sequence length distribution](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/Help/3%20Analysis%20Modules/7%20Sequence%20Length%20Distribution.html)

![](figures/qc/sequence_length.png){.class width=50%}


A graph showing the distribution of fragment sizes in the file which was analysed. Here, you can see a sample with many short, and a few very long reads. 

Some high throughput sequencers generate sequence fragments of uniform length, but others can contain reads of varying lengths.

### [Sequence Duplication Levels](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/Help/3%20Analysis%20Modules/8%20Duplicate%20Sequences.html)

![](figures/qc/duplication_levels.png){.class width=50%}

This plot shows how often identical sequences occur in the data. In a diverse library most sequences will occur only once in the final set, so most sequences should fall into the far left of the plot

High duplication can arise from:

- PCR amplification bias.
- Low library complexity.
- Very deep sequencing.

In plant breeding data, duplication is not always technical. Highly conserved or repetitive regions can also produce high duplication levels.

Interpretation depends strongly on the type of experiment and the genome being studied.

### [Overrepresented sequences](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/Help/3%20Analysis%20Modules/9%20Overrepresented%20Sequences.html)

![](figures/qc/overrepresented.png){.class width=50%}

FastQC also identifies sequences that occur much more often than expected. A **normal high-throughput library will contain a diverse set of sequences**, with no individual sequence making up a substantial fraction of the whole.

Overrepresented sequences might be biologically significant, or indicate that the library is contaminated, or simply not as diverse as expected. They can be adapter fragments, primers or highly repetitive genomic regions.

This module is often useful for diagnosing specific technical issues, especially when combined with adapter content and duplication plots.

### [Kmer content](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/Help/3%20Analysis%20Modules/11%20Kmer%20Content.html)

![](figures/qc/kmer_profiles.png){.class width=50%}



### [Adapter content](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/Help/3%20Analysis%20Modules/10%20Adapter%20Content.html)

![](figures/qc/adapter.png){.class width=50%}

This module will detect adapter content and plot it together with the identity of the adapter. 

Good to know if you have adapter contamination, and which ones you might have to remove from the data. 


